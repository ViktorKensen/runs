<?xml version='1.0' encoding='UTF-8'?>
<model name="modules" xmlns="http://www.cellml.org/cellml/1.1#" xmlns:cellml="http://www.cellml.org/cellml/1.1#" xmlns:xlink="http://www.w3.org/1999/xlink">
<!--&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;module_units&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;//-->
<import xlink:href="3compartment_units.cellml">
    <units name="s2" units_ref="s2"/>
    <units name="Hz" units_ref="Hz"/>
    <units name="millis" units_ref="millis"/>
    <units name="per_millis" units_ref="per_millis"/>
    <units name="mm" units_ref="mm"/>
    <units name="m2" units_ref="m2"/>
    <units name="mm2" units_ref="mm2"/>
    <units name="m3" units_ref="m3"/>
    <units name="m4" units_ref="m4"/>
    <units name="mm3" units_ref="mm3"/>
    <units name="J_per_s" units_ref="J_per_s"/>
    <units name="mol_per_s" units_ref="mol_per_s"/>
    <units name="mmol_per_s" units_ref="mmol_per_s"/>
    <units name="umol_per_s" units_ref="umol_per_s"/>
    <units name="C_per_s" units_ref="C_per_s"/>
    <units name="mC_per_s" units_ref="mC_per_s"/>
    <units name="uC_per_s" units_ref="uC_per_s"/>
    <units name="nC_per_s" units_ref="nC_per_s"/>
    <units name="Cm_per_millis" units_ref="Cm_per_millis"/>
    <units name="m_per_s" units_ref="m_per_s"/>
    <units name="mm_per_s" units_ref="mm_per_s"/>
    <units name="um_per_s" units_ref="um_per_s"/>
    <units name="rad_per_s" units_ref="rad_per_s"/>
    <units name="m3_per_s" units_ref="m3_per_s"/>
    <units name="mL" units_ref="mL"/>
    <units name="per_milliL_s" units_ref="per_milliL_s"/>
    <units name="s_per_m3" units_ref="s_per_m3"/>
    <units name="s_per_milliV" units_ref="s_per_milliV"/>
    <units name="s_per_millis" units_ref="s_per_millis"/>
    <units name="millis_per_s" units_ref="millis_per_s"/>
    <units name="mm3_per_s" units_ref="mm3_per_s"/>
    <units name="l_per_s" units_ref="l_per_s"/>
    <units name="per_ml_s" units_ref="per_ml_s"/>
    <units name="J_per_mol" units_ref="J_per_mol"/>
    <units name="J_per_kmol_K" units_ref="J_per_kmol_K"/>
    <units name="J_per_M" units_ref="J_per_M"/>
    <units name="J_per_C" units_ref="J_per_C"/>
    <units name="J_per_C_s" units_ref="J_per_C_s"/>
    <units name="J_per_m" units_ref="J_per_m"/>
    <units name="J_per_m3" units_ref="J_per_m3"/>
    <units name="mmHg" units_ref="mmHg"/>
    <units name="m3_per_J" units_ref="m3_per_J"/>
    <units name="J_per_m3s" units_ref="J_per_m3s"/>
    <units name="m3_per_Js" units_ref="m3_per_Js"/>
    <units name="J2_per_m6" units_ref="J2_per_m6"/>
    <units name="Js2_per_C2" units_ref="Js2_per_C2"/>
    <units name="Js2_per_mol2" units_ref="Js2_per_mol2"/>
    <units name="Js_per_mol2" units_ref="Js_per_mol2"/>
    <units name="Js_per_C2" units_ref="Js_per_C2"/>
    <units name="J_per_mol2" units_ref="J_per_mol2"/>
    <units name="C2_per_J_s" units_ref="C2_per_J_s"/>
    <units name="J_per_C2" units_ref="J_per_C2"/>
    <units name="C2_per_J" units_ref="C2_per_J"/>
    <units name="mol_per_m3" units_ref="mol_per_m3"/>
    <units name="M" units_ref="M"/>
    <units name="mM" units_ref="mM"/>
    <units name="uM" units_ref="uM"/>
    <units name="kg_per_m3" units_ref="kg_per_m3"/>
    <units name="m3_per_kg" units_ref="m3_per_kg"/>
    <units name="per_m3" units_ref="per_m3"/>
    <units name="mol_per_m2_s" units_ref="mol_per_m2_s"/>
    <units name="mM_m_per_s" units_ref="mM_m_per_s"/>
    <units name="J_per_m2_s" units_ref="J_per_m2_s"/>
    <units name="Js_per_m4" units_ref="Js_per_m4"/>
    <units name="mM_per_s" units_ref="mM_per_s"/>
    <units name="per_s" units_ref="per_s"/>
    <units name="per_mM_s" units_ref="per_mM_s"/>
    <units name="m6_per_mol2_s" units_ref="m6_per_mol2_s"/>
    <units name="m3_per_mol" units_ref="m3_per_mol"/>
    <units name="mol_per_m3_s" units_ref="mol_per_m3_s"/>
    <units name="per_mol" units_ref="per_mol"/>
    <units name="J_per_mol_K" units_ref="J_per_mol_K"/>
    <units name="C_per_mol" units_ref="C_per_mol"/>
    <units name="m2_per_s" units_ref="m2_per_s"/>
    <units name="per_C" units_ref="per_C"/>
    <units name="per_m" units_ref="per_m"/>
    <units name="per_mM" units_ref="per_mM"/>
    <units name="Js2_per_m2" units_ref="Js2_per_m2"/>
    <units name="Js_per_m2" units_ref="Js_per_m2"/>
    <units name="J_per_m2" units_ref="J_per_m2"/>
    <units name="m_per_s2" units_ref="m_per_s2"/>
    <units name="rad_per_s2" units_ref="rad_per_s2"/>
    <units name="Js_per_m3" units_ref="Js_per_m3"/>
    <units name="Js2_per_m5" units_ref="Js2_per_m5"/>
    <units name="m5_per_Js2" units_ref="m5_per_Js2"/>
    <units name="J_per_m6" units_ref="J_per_m6"/>
    <units name="m6_per_J" units_ref="m6_per_J"/>
    <units name="m6_per_Js" units_ref="m6_per_Js"/>
    <units name="mm6_per_J" units_ref="mm6_per_J"/>
    <units name="Js2_per_m9" units_ref="Js2_per_m9"/>
    <units name="m6s_per_J" units_ref="m6s_per_J"/>
    <units name="Js_per_m6" units_ref="Js_per_m6"/>
    <units name="Js2_per_m6" units_ref="Js2_per_m6"/>
    <units name="m3_per_s2" units_ref="m3_per_s2"/>
    <units name="mm3_per_s2" units_ref="mm3_per_s2"/>
    <units name="per_mm3" units_ref="per_mm3"/>
    <units name="UnitValve" units_ref="UnitValve"/>
    <units name="J_per_m9" units_ref="J_per_m9"/>
    <units name="milliV" units_ref="milliV"/>
    <units name="per_milliV" units_ref="per_milliV"/>
    <units name="millis_per_milliV" units_ref="millis_per_milliV"/>
    <units name="per_V" units_ref="per_V"/>
    <units name="milliV_per_V" units_ref="milliV_per_V"/>
    <units name="V_per_milliV" units_ref="V_per_milliV"/>
    <units name="V_per_s" units_ref="V_per_s"/>
    <units name="milliV_per_kiloV" units_ref="milliV_per_kiloV"/>
    <units name="V2" units_ref="V2"/>
    <units name="milliV2" units_ref="milliV2"/>
    <units name="millimol" units_ref="millimol"/>
    <units name="millimolar" units_ref="millimolar"/>
    <units name="per_millimolar" units_ref="per_millimolar"/>
    <units name="per_millimolar_s" units_ref="per_millimolar_s"/>
    <units name="per_millimolar2_s" units_ref="per_millimolar2_s"/>
    <units name="millimolar_per_s" units_ref="millimolar_per_s"/>
    <units name="millimolar_per_megamolar" units_ref="millimolar_per_megamolar"/>
    <units name="per_millimol_milliS" units_ref="per_millimol_milliS"/>
    <units name="per_millimol_millis" units_ref="per_millimol_millis"/>
    <units name="per_millimol_s" units_ref="per_millimol_s"/>
    <units name="microm" units_ref="microm"/>
    <units name="microS" units_ref="microS"/>
    <units name="microm3" units_ref="microm3"/>
    <units name="m3_per_microm3" units_ref="m3_per_microm3"/>
    <units name="picoF" units_ref="picoF"/>
    <units name="S_per_F" units_ref="S_per_F"/>
    <units name="m3_per_Fs" units_ref="m3_per_Fs"/>
    <units name="A_per_F" units_ref="A_per_F"/>
    <units name="megaOhm" units_ref="megaOhm"/>
    <units name="nanoA" units_ref="nanoA"/>
    <units name="nanoA_per_milliA" units_ref="nanoA_per_milliA"/>
    <units name="A_per_nanoA" units_ref="A_per_nanoA"/>
    <units name="J_per_MK" units_ref="J_per_MK"/>
    <units name="C_per_M" units_ref="C_per_M"/>
    <units name="m3_per_J_millis" units_ref="m3_per_J_millis"/>
    <units name="m3_per_M_millis" units_ref="m3_per_M_millis"/>
    <units name="m3_per_millimol_s" units_ref="m3_per_millimol_s"/>
    <units name="millimol_per_m3" units_ref="millimol_per_m3"/>
    <units name="Hz2" units_ref="Hz2"/>
    <units name="cm" units_ref="cm"/>
    <units name="J_per_m4_s" units_ref="J_per_m4_s"/>
    <units name="m3_per_mol_per_sec" units_ref="m3_per_mol_per_sec"/>
    <units name="mol_per_m3_per_kPa" units_ref="mol_per_m3_per_kPa"/>
    <units name="mol_per_m3_per_Pa" units_ref="mol_per_m3_per_Pa"/>
    <units name="m3_per_mol_per_s" units_ref="m3_per_mol_per_s"/>
    <units name="mol_per_m3_per_s" units_ref="mol_per_m3_per_s"/>
    <units name="dim" units_ref="dim"/>
    <units name="fmol" units_ref="fmol"/>
    <units name="per_fmol" units_ref="per_fmol"/>
    <units name="nJ_per_s" units_ref="nJ_per_s"/>
    <units name="fmol_per_s" units_ref="fmol_per_s"/>
    <units name="nC_per_fmol" units_ref="nC_per_fmol"/>
    <units name="nC" units_ref="nC"/>
    <units name="nJ_per_fmol" units_ref="nJ_per_fmol"/>
    <units name="nJ_per_nC" units_ref="nJ_per_nC"/>
    <units name="fC" units_ref="fC"/>
    <units name="fF" units_ref="fF"/>
    <units name="volt_per_sec" units_ref="volt_per_sec"/>
    <units name="J_per_K_per_mol" units_ref="J_per_K_per_mol"/>
</import>
    <component name="heart_Ca_input">
        <!-- Warning this module should not be used if you are varying period, without also varying the T_ar, T_ac, T_vr, T_vc-->
        <variable name="t" public_interface="in" units="second"/>
        <variable initial_value="0.0" name="s" public_interface="out" units="dimensionless"/>
        <!-- Constitutive parameters-->
        <variable name="mt" public_interface="out" units="dimensionless"/>
        <variable name="e_a" public_interface="out" units="dimensionless"/>
        <variable name="e_v" public_interface="out" units="dimensionless"/>
        <variable name="T" public_interface="in" units="second"/>
        <!-- ______ (PETER) Delete from here __________-->
        <variable name="T_ac" public_interface="in" units="second"/>
        <variable name="T_ar" public_interface="in" units="second"/>
        <!-- var T_ac_norm: dimensionless {pub: out};
 var T_ar_norm: dimensionless {pub: out};-->
        <variable name="t_astart" public_interface="in" units="second"/>
        <variable name="t_astart_norm" public_interface="out" units="dimensionless"/>
        <variable name="T_vc" public_interface="in" units="second"/>
        <variable name="T_vr" public_interface="in" units="second"/>
        <!-- var T_vc_norm: dimensionless {pub: out};
 var T_vr_norm: dimensionless {pub: out};-->
        <variable name="t_vstart" public_interface="in" units="second"/>
        <variable name="t_vstart_norm" public_interface="out" units="dimensionless"/>
        <!-- _____ (PETER) TO here ______________-->
        <variable name="E_lv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_lv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_la_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_rv_B" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_A" public_interface="in" units="J_per_m6"/>
        <variable name="E_ra_B" public_interface="in" units="J_per_m6"/>
        <variable name="q_ra_us" public_interface="in" units="m3"/>
        <variable name="q_rv_us" public_interface="in" units="m3"/>
        <variable name="q_la_us" public_interface="in" units="m3"/>
        <variable name="q_lv_us" public_interface="in" units="m3"/>
        <variable name="q_ra_init" public_interface="in" units="m3"/>
        <variable name="q_rv_init" public_interface="in" units="m3"/>
        <variable name="q_la_init" public_interface="in" units="m3"/>
        <variable name="q_lv_init" public_interface="in" units="m3"/>
        <!-- State Variables-->
        <variable name="u_ra" public_interface="out" units="J_per_m3"/>
        <variable name="u_rv" public_interface="out" units="J_per_m3"/>
        <variable name="u_la" public_interface="out" units="J_per_m3"/>
        <variable name="u_lv" public_interface="out" units="J_per_m3"/>
        <variable name="u_root" public_interface="in" units="J_per_m3"/>
        <variable name="u_par" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0" name="v_trv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_puv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_miv" public_interface="out" units="m3_per_s"/>
        <variable initial_value="0" name="v_aov" public_interface="out" units="m3_per_s"/>
        <variable name="v_svc" public_interface="in" units="m3_per_s"/>
        <variable name="v_ivc" public_interface="in" units="m3_per_s"/>
        <variable name="v_pvn" public_interface="in" units="m3_per_s"/>
        <variable name="L_trv" units="Js2_per_m6"/>
        <variable name="L_puv" units="Js2_per_m6"/>
        <variable name="L_miv" units="Js2_per_m6"/>
        <variable name="L_aov" units="Js2_per_m6"/>
        <variable name="A_eff_trv" public_interface="out" units="m2"/>
        <variable name="A_eff_puv" public_interface="out" units="m2"/>
        <variable name="A_eff_miv" public_interface="out" units="m2"/>
        <variable name="A_eff_aov" public_interface="out" units="m2"/>
        <variable name="A_nn_trv" public_interface="in" units="m2"/>
        <variable name="A_nn_puv" public_interface="in" units="m2"/>
        <variable name="A_nn_miv" public_interface="in" units="m2"/>
        <variable name="A_nn_aov" public_interface="in" units="m2"/>
        <variable name="l_eff" public_interface="in" units="metre"/>
        <variable name="K_vo_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vo_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_trv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_puv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_miv" public_interface="in" units="m3_per_Js"/>
        <variable name="K_vc_aov" public_interface="in" units="m3_per_Js"/>
        <variable name="M_rg_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_rg_aov" public_interface="in" units="dimensionless"/>
        <variable name="M_st_trv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_puv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_miv" public_interface="in" units="dimensionless"/>
        <variable name="M_st_aov" public_interface="in" units="dimensionless"/>
        <variable name="rho" public_interface="in" units="Js2_per_m5"/>
        <variable name="B_trv" public_interface="out" units="Js2_per_m9"/>
        <variable name="B_puv" public_interface="out" units="Js2_per_m9"/>
        <variable name="B_miv" public_interface="out" units="Js2_per_m9"/>
        <variable name="B_aov" public_interface="out" units="Js2_per_m9"/>
        <variable name="zeta_trv" public_interface="out" units="dimensionless"/>
        <variable name="zeta_puv" public_interface="out" units="dimensionless"/>
        <variable name="zeta_miv" public_interface="out" units="dimensionless"/>
        <variable name="zeta_aov" public_interface="out" units="dimensionless"/>
        <variable initial_value="0" name="zeta_trv_pre" public_interface="out" units="dimensionless"/>
        <variable initial_value="0" name="zeta_puv_pre" public_interface="out" units="dimensionless"/>
        <variable initial_value="0" name="zeta_miv_pre" public_interface="out" units="dimensionless"/>
        <variable initial_value="0" name="zeta_aov_pre" public_interface="out" units="dimensionless"/>
        <variable initial_value="1e-14" name="eps_m4" units="m4"/>
        <variable initial_value="1e-14" name="eps_m2" units="m2"/>
        <variable initial_value="0.07" name="eps_1" units="dimensionless"/>
        <variable initial_value="0.02" name="eps_2" units="dimensionless"/>
        <!-- TODO the below parameters should be set in an init_states parameter file
 q_lv gets identified, the others are set arbitrarily, identifying q_lv sets the stressed volume of the system.-->
        <variable initial_value="q_lv_init" name="q_lv" public_interface="out" units="m3"/>
        <variable initial_value="q_rv_init" name="q_rv" public_interface="out" units="m3"/>
        <variable initial_value="q_la_init" name="q_la" public_interface="out" units="m3"/>
        <variable initial_value="q_ra_init" name="q_ra" public_interface="out" units="m3"/>
        <!-- ____________ PETER DELETE FROM HERE ______________
 calculate modified time due to changes in heart period. This can now be modified throughout a simulation.-->
        <!-- TODO update all heart models to have the below chi calculations, it is more numerically robust.-->
        <variable initial_value="0.0" name="chi_a" public_interface="out" units="dimensionless"/>
        <variable name="chi_afloor" public_interface="out" units="dimensionless"/>
        <variable name="chi_afloor_final" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_afloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_a</ci>
                    <apply>
                        <floor/>
                        <ci>chi_a</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_a</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_astart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_astart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_astart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_ac</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_afloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_ar</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                            <apply>
                                <lt/>
                                <ci>chi_afloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.5</cn>
                            <apply>
                                <minus/>
                                <apply>
                                    <minus/>
                                    <ci>T</ci>
                                    <ci>T_ac</ci>
                                </apply>
                                <ci>T_ar</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="per_s">0.0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <ci>chi_afloor_final</ci>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                        <apply>
                            <leq/>
                            <ci>chi_afloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0.0</cn>
                    </otherwise>
                </piecewise>
            </apply>
        </math>
        <variable initial_value="0.0" name="chi_v" units="dimensionless"/>
        <variable name="chi_vfloor" units="dimensionless"/>
        <variable name="chi_vfloor_final" units="dimensionless"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>chi_vfloor</ci>
                <apply>
                    <minus/>
                    <ci>chi_v</ci>
                    <apply>
                        <floor/>
                        <ci>chi_v</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>chi_v</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <geq/>
                                <ci>mt</ci>
                                <ci>t_vstart_norm</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <apply>
                                    <plus/>
                                    <ci>t_vstart_norm</ci>
                                    <ci>eps_1</ci>
                                </apply>
                                <cn cellml:units="dimensionless">1.0</cn>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>mt</ci>
                                <apply>
                                    <minus/>
                                    <apply>
                                        <plus/>
                                        <ci>t_vstart_norm</ci>
                                        <ci>eps_1</ci>
                                    </apply>
                                    <cn cellml:units="dimensionless">1.0</cn>
                                </apply>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_vc</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <ci>eps_2</ci>
                            </apply>
                            <apply>
                                <leq/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.25</cn>
                            <ci>T_vr</ci>
                        </apply>
                        <apply>
                            <and/>
                            <apply>
                                <gt/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.25</cn>
                            </apply>
                            <apply>
                                <lt/>
                                <ci>chi_vfloor</ci>
                                <cn cellml:units="dimensionless">0.5</cn>
                            </apply>
                        </apply>
                    </piece>
                    <piece>
                        <apply>
                            <divide/>
                            <cn cellml:units="dimensionless">0.5</cn>
                            <apply>
                                <minus/>
                                <apply>
                                    <minus/>
                                    <ci>T</ci>
                                    <ci>T_vc</ci>
                                </apply>
                                <ci>T_vr</ci>
                            </apply>
                        </apply>
                        <apply>
                            <gt/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="per_s">0.0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <ci>chi_vfloor_final</ci>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                        <apply>
                            <leq/>
                            <ci>chi_vfloor</ci>
                            <cn cellml:units="dimensionless">0.5</cn>
                        </apply>
                    </piece>
                    <otherwise>
                        <cn cellml:units="dimensionless">0.0</cn>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>s</ci>
                </apply>
                <apply>
                    <divide/>
                    <cn cellml:units="dimensionless">1</cn>
                    <ci>T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>mt</ci>
                <apply>
                    <minus/>
                    <ci>s</ci>
                    <apply>
                        <floor/>
                        <ci>s</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Elastance Functions-->
            <apply>
                <eq/>
                <ci>t_astart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_astart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <!-- T_ac_norm     = T_ac/T;
 T_ar_norm     = T_ar/T;-->
            <apply>
                <eq/>
                <ci>t_vstart_norm</ci>
                <apply>
                    <divide/>
                    <ci>t_vstart</ci>
                    <ci>T</ci>
                </apply>
            </apply>
            <!-- T_vc_norm     = T_vc/T;
 T_vr_norm     = T_vr/T;-->
            <!-- ____________ (PETER) TO HERE ______________-->
            <!-- ____________ (PETER) These are the normalised elastance functions that need to be changed to be dependent of Ca
 When e_v equals 1 elastance equals E_lv_B (min elastance), when e_v equals 1,  elastance equals E_lv_B+E_lv_A (max elastance).-->
            <apply>
                <eq/>
                <ci>e_a</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_afloor_final</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>e_v</ci>
                <apply>
                    <times/>
                    <cn cellml:units="dimensionless">0.5</cn>
                    <apply>
                        <minus/>
                        <cn cellml:units="dimensionless">1</cn>
                        <apply>
                            <cos/>
                            <apply>
                                <times/>
                                <cn cellml:units="dimensionless">2</cn>
                                <pi/>
                                <ci>chi_vfloor_final</ci>
                            </apply>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <!-- Valve model-->
            <apply>
                <eq/>
                <ci>B_trv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_trv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps_m4</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_puv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_puv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps_m4</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_miv</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_miv</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps_m4</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>B_aov</ci>
                <apply>
                    <divide/>
                    <ci>rho</ci>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <cn cellml:units="dimensionless">2</cn>
                            <apply>
                                <power/>
                                <ci>A_eff_aov</ci>
                                <cn cellml:units="dimensionless">2</cn>
                            </apply>
                        </apply>
                        <ci>eps_m4</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_trv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_trv</ci>
                        <ci>eps_m2</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_puv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_puv</ci>
                        <ci>eps_m2</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_miv</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_miv</ci>
                        <ci>eps_m2</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>L_aov</ci>
                <apply>
                    <divide/>
                    <apply>
                        <times/>
                        <ci>rho</ci>
                        <ci>l_eff</ci>
                    </apply>
                    <apply>
                        <plus/>
                        <ci>A_eff_aov</ci>
                        <ci>eps_m2</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_trv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_trv</ci>
                                <ci>A_nn_trv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_trv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_trv</ci>
                        <ci>A_nn_trv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_puv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_puv</ci>
                                <ci>A_nn_puv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_puv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_puv</ci>
                        <ci>A_nn_puv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_miv</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_miv</ci>
                                <ci>A_nn_miv</ci>
                            </apply>
                        </apply>
                        <ci>zeta_miv</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_miv</ci>
                        <ci>A_nn_miv</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>A_eff_aov</ci>
                <apply>
                    <plus/>
                    <apply>
                        <times/>
                        <apply>
                            <minus/>
                            <apply>
                                <times/>
                                <ci>M_st_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                            <apply>
                                <times/>
                                <ci>M_rg_aov</ci>
                                <ci>A_nn_aov</ci>
                            </apply>
                        </apply>
                        <ci>zeta_aov</ci>
                    </apply>
                    <apply>
                        <times/>
                        <ci>M_rg_aov</ci>
                        <ci>A_nn_aov</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_trv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_trv_pre</ci>
                            </apply>
                            <ci>K_vo_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_ra</ci>
                            <ci>u_rv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_trv_pre</ci>
                            <ci>K_vc_trv</ci>
                            <apply>
                                <minus/>
                                <ci>u_ra</ci>
                                <ci>u_rv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_puv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_puv_pre</ci>
                            </apply>
                            <ci>K_vo_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_rv</ci>
                            <ci>u_par</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_puv_pre</ci>
                            <ci>K_vc_puv</ci>
                            <apply>
                                <minus/>
                                <ci>u_rv</ci>
                                <ci>u_par</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_miv_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_miv_pre</ci>
                            </apply>
                            <ci>K_vo_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_la</ci>
                            <ci>u_lv</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_miv_pre</ci>
                            <ci>K_vc_miv</ci>
                            <apply>
                                <minus/>
                                <ci>u_la</ci>
                                <ci>u_lv</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>zeta_aov_pre</ci>
                </apply>
                <piecewise>
                    <piece>
                        <apply>
                            <times/>
                            <apply>
                                <minus/>
                                <cn cellml:units="dimensionless">1</cn>
                                <ci>zeta_aov_pre</ci>
                            </apply>
                            <ci>K_vo_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                        <apply>
                            <geq/>
                            <ci>u_lv</ci>
                            <ci>u_root</ci>
                        </apply>
                    </piece>
                    <otherwise>
                        <apply>
                            <times/>
                            <ci>zeta_aov_pre</ci>
                            <ci>K_vc_aov</ci>
                            <apply>
                                <minus/>
                                <ci>u_lv</ci>
                                <ci>u_root</ci>
                            </apply>
                        </apply>
                    </otherwise>
                </piecewise>
            </apply>
            <!-- The below ensures zeta can't be negative-->
            <apply>
                <eq/>
                <ci>zeta_trv</ci>
                <apply>
                    <max/>
                    <ci>zeta_trv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_puv</ci>
                <apply>
                    <max/>
                    <ci>zeta_puv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_miv</ci>
                <apply>
                    <max/>
                    <ci>zeta_miv_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>zeta_aov</ci>
                <apply>
                    <max/>
                    <ci>zeta_aov_pre</ci>
                    <cn cellml:units="dimensionless">0</cn>
                </apply>
            </apply>
            <!-- calculate the flow through the valves-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_trv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_trv</ci>
                                </apply>
                                <ci>v_trv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_trv</ci>
                                </apply>
                            </apply>
                            <ci>u_ra</ci>
                        </apply>
                        <ci>u_rv</ci>
                    </apply>
                    <ci>L_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_puv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_puv</ci>
                                </apply>
                                <ci>v_puv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_puv</ci>
                                </apply>
                            </apply>
                            <ci>u_rv</ci>
                        </apply>
                        <ci>u_par</ci>
                    </apply>
                    <ci>L_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_miv</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_miv</ci>
                                </apply>
                                <ci>v_miv</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_miv</ci>
                                </apply>
                            </apply>
                            <ci>u_la</ci>
                        </apply>
                        <ci>u_lv</ci>
                    </apply>
                    <ci>L_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_aov</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <plus/>
                            <apply>
                                <times/>
                                <apply>
                                    <minus/>
                                    <ci>B_aov</ci>
                                </apply>
                                <ci>v_aov</ci>
                                <apply>
                                    <abs/>
                                    <ci>v_aov</ci>
                                </apply>
                            </apply>
                            <ci>u_lv</ci>
                        </apply>
                        <ci>u_root</ci>
                    </apply>
                    <ci>L_aov</ci>
                </apply>
            </apply>
            <!-- Constitutive Relations-->
            <apply>
                <eq/>
                <ci>u_ra</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_ra_A</ci>
                        </apply>
                        <ci>E_ra_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_ra</ci>
                        <ci>q_ra_us</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_rv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_rv_A</ci>
                        </apply>
                        <ci>E_rv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_rv</ci>
                        <ci>q_rv_us</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_la</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_a</ci>
                            <ci>E_la_A</ci>
                        </apply>
                        <ci>E_la_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_la</ci>
                        <ci>q_la_us</ci>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_lv</ci>
                <apply>
                    <times/>
                    <apply>
                        <plus/>
                        <apply>
                            <times/>
                            <ci>e_v</ci>
                            <ci>E_lv_A</ci>
                        </apply>
                        <ci>E_lv_B</ci>
                    </apply>
                    <apply>
                        <minus/>
                        <ci>q_lv</ci>
                        <ci>q_lv_us</ci>
                    </apply>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_ra</ci>
                </apply>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>v_svc</ci>
                        <ci>v_ivc</ci>
                    </apply>
                    <ci>v_trv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_rv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_trv</ci>
                    <ci>v_puv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_la</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_pvn</ci>
                    <ci>v_miv</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_lv</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_miv</ci>
                    <ci>v_aov</ci>
                </apply>
            </apply>
        </math>
    </component>
    <component name="vv_simple_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="I" public_interface="in" units="Js2_per_m6"/>
        <variable name="C" public_interface="in" units="m6_per_J"/>
        <variable name="R" public_interface="in" units="Js_per_m6"/>
        <variable name="R_v" public_interface="out" units="Js_per_m6"/>
        <!-- State Variables-->
        <variable name="u_ext" public_interface="in" units="J_per_m3"/>
        <variable name="v_in" public_interface="in" units="m3_per_s"/>
        <variable name="u" public_interface="out" units="J_per_m3"/>
        <variable name="u_C" public_interface="out" units="J_per_m3"/>
        <variable initial_value="0.0" name="v" public_interface="out" units="m3_per_s"/>
        <variable name="u_d" public_interface="out" units="J_per_m3"/>
        <variable name="u_C_d" public_interface="out" units="J_per_m3"/>
        <variable name="v_out" public_interface="in" units="m3_per_s"/>
        <variable initial_value="0.0" name="q_C" public_interface="out" units="m3"/>
        <variable initial_value="0.0" name="q_C_d" public_interface="out" units="m3"/>
        <!-- Constitutive Relations-->
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>R_v</ci>
                <apply>
                    <divide/>
                    <cn cellml:units="second">0.01</cn>
                    <ci>C</ci>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <ci>u</ci>
                            <ci>u_d</ci>
                        </apply>
                        <apply>
                            <times/>
                            <ci>R</ci>
                            <ci>v</ci>
                        </apply>
                    </apply>
                    <ci>I</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_C</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_in</ci>
                    <ci>v</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_C</ci>
                <apply>
                    <plus/>
                    <apply>
                        <divide/>
                        <ci>q_C</ci>
                        <apply>
                            <divide/>
                            <ci>C</ci>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                    </apply>
                    <ci>u_ext</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_C_d</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v</ci>
                    <ci>v_out</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_C_d</ci>
                <apply>
                    <plus/>
                    <apply>
                        <divide/>
                        <ci>q_C_d</ci>
                        <apply>
                            <divide/>
                            <ci>C</ci>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                    </apply>
                    <ci>u_ext</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u</ci>
                <apply>
                    <plus/>
                    <ci>u_C</ci>
                    <apply>
                        <times/>
                        <cn cellml:units="dimensionless">2</cn>
                        <ci>R_v</ci>
                        <apply>
                            <minus/>
                            <ci>v_in</ci>
                            <ci>v</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_d</ci>
                <apply>
                    <plus/>
                    <ci>u_C_d</ci>
                    <apply>
                        <times/>
                        <cn cellml:units="dimensionless">2</cn>
                        <ci>R_v</ci>
                        <apply>
                            <minus/>
                            <ci>v</ci>
                            <ci>v_out</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="vp_simple_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="I" public_interface="in" units="Js2_per_m6"/>
        <variable name="C" public_interface="in" units="m6_per_J"/>
        <variable name="R" public_interface="in" units="Js_per_m6"/>
        <variable name="R_v" public_interface="out" units="Js_per_m6"/>
        <!-- State Variables-->
        <variable name="u_ext" public_interface="in" units="J_per_m3"/>
        <variable name="v_in" public_interface="in" units="m3_per_s"/>
        <variable name="u" public_interface="out" units="J_per_m3"/>
        <variable initial_value="0.0" name="q_C" public_interface="out" units="m3"/>
        <variable name="u_C" public_interface="out" units="J_per_m3"/>
        <variable initial_value="0.0" name="v" public_interface="out" units="m3_per_s"/>
        <variable name="u_out" public_interface="in" units="J_per_m3"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>R_v</ci>
                <apply>
                    <divide/>
                    <cn cellml:units="second">0.01</cn>
                    <ci>C</ci>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <ci>u</ci>
                            <ci>u_out</ci>
                        </apply>
                        <apply>
                            <times/>
                            <ci>R</ci>
                            <ci>v</ci>
                        </apply>
                    </apply>
                    <ci>I</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_C</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v_in</ci>
                    <ci>v</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_C</ci>
                <apply>
                    <plus/>
                    <apply>
                        <divide/>
                        <ci>q_C</ci>
                        <ci>C</ci>
                    </apply>
                    <ci>u_ext</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u</ci>
                <apply>
                    <plus/>
                    <ci>u_C</ci>
                    <apply>
                        <times/>
                        <ci>R_v</ci>
                        <apply>
                            <minus/>
                            <ci>v_in</ci>
                            <ci>v</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="vp_ven_simple_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="I" public_interface="in" units="Js2_per_m6"/>
        <variable name="C" public_interface="in" units="m6_per_J"/>
        <variable name="R" public_interface="in" units="Js_per_m6"/>
        <variable name="R_v" public_interface="out" units="Js_per_m6"/>
        <!-- State Variables-->
        <variable name="u_ext" public_interface="in" units="J_per_m3"/>
        <variable name="v_in" public_interface="in" units="m3_per_s"/>
        <variable name="u" public_interface="out" units="J_per_m3"/>
        <variable name="q_C_init" public_interface="in" units="m3"/>
        <variable initial_value="q_C_init" name="q_C_change" public_interface="out" units="m3"/>
        <variable name="q_C" public_interface="out" units="m3"/>
        <variable name="q" public_interface="out" units="m3"/>
        <variable name="u_C" public_interface="out" units="J_per_m3"/>
        <variable initial_value="0.0" name="v" public_interface="out" units="m3_per_s"/>
        <variable name="u_out" public_interface="in" units="J_per_m3"/>
        <variable name="q_us_0" public_interface="in" units="m3"/>
        <variable name="q_us_wCont" public_interface="out" units="m3"/>
        <variable name="Delta_q_us" public_interface="in" units="m3"/>
        <variable name="Delta_C" public_interface="in" units="m6_per_J"/>
        <variable name="C_wCont" public_interface="out" units="m6_per_J"/>
        <variable name="v_inf" public_interface="in" units="m3_per_s"/>
        <!-- TODO double check that this applies to veins-->
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>R_v</ci>
                <apply>
                    <divide/>
                    <cn cellml:units="second">0.01</cn>
                    <ci>C</ci>
                </apply>
            </apply>
            <!-- Conservation Laws-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <ci>u</ci>
                            <ci>u_out</ci>
                        </apply>
                        <apply>
                            <times/>
                            <ci>R</ci>
                            <ci>v</ci>
                        </apply>
                    </apply>
                    <ci>I</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_C_change</ci>
                </apply>
                <apply>
                    <plus/>
                    <apply>
                        <minus/>
                        <ci>v_in</ci>
                        <ci>v</ci>
                    </apply>
                    <ci>v_inf</ci>
                </apply>
            </apply>
            <!-- TODO CHECK THAT CHANGING US VOLUME LIKE THIS CONSERVES VOLUME!!!!-->
            <apply>
                <eq/>
                <ci>q_C</ci>
                <apply>
                    <minus/>
                    <apply>
                        <plus/>
                        <ci>q_C_change</ci>
                        <ci>q_us_0</ci>
                    </apply>
                    <ci>q_us_wCont</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>q</ci>
                <apply>
                    <plus/>
                    <ci>q_C</ci>
                    <ci>q_us_wCont</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_C</ci>
                <apply>
                    <plus/>
                    <apply>
                        <divide/>
                        <ci>q_C</ci>
                        <ci>C_wCont</ci>
                    </apply>
                    <ci>u_ext</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u</ci>
                <apply>
                    <plus/>
                    <ci>u_C</ci>
                    <apply>
                        <times/>
                        <ci>R_v</ci>
                        <apply>
                            <minus/>
                            <ci>v_in</ci>
                            <ci>v</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>q_us_wCont</ci>
                <apply>
                    <plus/>
                    <ci>q_us_0</ci>
                    <ci>Delta_q_us</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>C_wCont</ci>
                <apply>
                    <plus/>
                    <ci>C</ci>
                    <ci>Delta_C</ci>
                </apply>
            </apply>
        </math>
    </component>
    <!--//////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////// output-BC Vessel ///////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////-->
    <component name="pp_T_fixed_I_type">
        <variable name="t" public_interface="in" units="second"/>
        <!-- Constitutive parameters-->
        <variable name="I_T" public_interface="out" units="Js2_per_m6"/>
        <variable name="R_v" public_interface="out" units="Js_per_m6"/>
        <variable name="R_T" public_interface="in" units="Js_per_m6"/>
        <variable name="C_T" public_interface="in" units="m6_per_J"/>
        <!-- State Variables-->
        <variable name="u_ext" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0.0" name="v" public_interface="out" units="m3_per_s"/>
        <variable name="u_in" public_interface="in" units="J_per_m3"/>
        <variable name="u" public_interface="out" units="J_per_m3"/>
        <variable name="u_C" public_interface="out" units="J_per_m3"/>
        <!-- v_T is the output flow to the venous side-->
        <variable initial_value="0.0" name="v_T" public_interface="out" units="m3_per_s"/>
        <variable name="u_out" public_interface="in" units="J_per_m3"/>
        <variable initial_value="0.0" name="q_T" public_interface="out" units="m3"/>
        <!-- Improve this R_v estimate?-->
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>R_v</ci>
                <apply>
                    <divide/>
                    <cn cellml:units="second">0.01</cn>
                    <ci>C_T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>I_T</ci>
                <cn cellml:units="Js2_per_m6" type="e-notation">1<sep/>-6</cn>
            </apply>
            <!-- Conservation Laws-->
            <!-- For now terminals don't have a gravity effect, change this for leg terminals-->
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>q_T</ci>
                </apply>
                <apply>
                    <minus/>
                    <ci>v</ci>
                    <ci>v_T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>u_C</ci>
                <apply>
                    <plus/>
                    <apply>
                        <divide/>
                        <ci>q_T</ci>
                        <ci>C_T</ci>
                    </apply>
                    <ci>u_ext</ci>
                </apply>
            </apply>
            <!-- + u_ext;-->
            <apply>
                <eq/>
                <ci>u</ci>
                <apply>
                    <plus/>
                    <ci>u_C</ci>
                    <apply>
                        <times/>
                        <ci>R_v</ci>
                        <apply>
                            <minus/>
                            <ci>v</ci>
                            <ci>v_T</ci>
                        </apply>
                    </apply>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <ci>u_in</ci>
                            <ci>u</ci>
                        </apply>
                        <apply>
                            <divide/>
                            <apply>
                                <times/>
                                <ci>v</ci>
                                <ci>R_T</ci>
                            </apply>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                    </apply>
                    <ci>I_T</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>v_T</ci>
                </apply>
                <apply>
                    <divide/>
                    <apply>
                        <minus/>
                        <apply>
                            <minus/>
                            <ci>u</ci>
                            <ci>u_out</ci>
                        </apply>
                        <apply>
                            <divide/>
                            <apply>
                                <times/>
                                <ci>v_T</ci>
                                <ci>R_T</ci>
                            </apply>
                            <cn cellml:units="dimensionless">2</cn>
                        </apply>
                    </apply>
                    <ci>I_T</ci>
                </apply>
            </apply>
        </math>
    </component>
    <component name="zero_flow">
        <variable name="v_zero" public_interface="out" units="m3_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>v_zero</ci>
                <cn cellml:units="m3_per_s">0</cn>
            </apply>
        </math>
    </component>
</model>
